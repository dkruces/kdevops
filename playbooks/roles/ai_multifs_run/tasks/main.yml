---
- name: Import optional extra_args file
  ansible.builtin.include_vars: "{{ item }}"
  ignore_errors: true
  with_items:
    - "../extra_vars.yaml"
  tags: vars

- name: Filter enabled filesystem configurations
  ansible.builtin.set_fact:
    enabled_fs_configs: "{{ ai_multifs_configurations | selectattr('enabled', 'equalto', true) | list }}"

- name: Run AI benchmarks on each filesystem configuration
  ansible.builtin.include_tasks: run_single_filesystem.yml
  loop: "{{ enabled_fs_configs }}"
  loop_control:
    loop_var: fs_config
    index_var: fs_index
  when: enabled_fs_configs | length > 0

- name: Generate multi-filesystem comparison report
  ansible.builtin.include_tasks: generate_comparison.yml
  when: enabled_fs_configs | length > 1
